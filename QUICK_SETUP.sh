#!/bin/bash
# ========================================
# –°–ö–†–ò–ü–¢ –ë–´–°–¢–†–û–ô –ù–ê–°–¢–†–û–ô–ö–ò –ü–ê–†–°–ï–†–ê
# ========================================
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ:
# bash QUICK_SETUP.sh
# ========================================

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø–∞—Ä—Å–µ—Ä–∞..."
echo ""

# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤
echo "üìÅ –®–∞–≥ 1/6: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞..."
chmod +x schedule.sh
chmod -R 775 storage
chmod -R 775 bootstrap/cache
mkdir -p storage/logs
chmod -R 775 storage/logs
echo "‚úÖ –ü—Ä–∞–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
echo ""

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ composer
echo "üì¶ –®–∞–≥ 2/6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
if [ ! -d "vendor" ]; then
    echo "‚ö†Ô∏è  Vendor –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
    php8.1 /usr/local/bin/composer install --no-dev --optimize-autoloader
else
    echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
fi
echo ""

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ .env
echo "‚öôÔ∏è  –®–∞–≥ 3/6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
if [ ! -f ".env" ]; then
    echo "‚ùå –û–®–ò–ë–ö–ê: –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "–°–∫–æ–ø–∏—Ä—É–π—Ç–µ .env.example –≤ .env –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"
    exit 1
else
    echo "‚úÖ –§–∞–π–ª .env –Ω–∞–π–¥–µ–Ω"
fi
echo ""

# 4. –ú–∏–≥—Ä–∞—Ü–∏–∏
echo "üóÑÔ∏è  –®–∞–≥ 4/6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."
php8.1 artisan migrate --force
echo "‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã"
echo ""

# 5. –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
echo "üß™ –®–∞–≥ 5/6: –¢–µ—Å—Ç–æ–≤—ã–π –ø–∞—Ä—Å–∏–Ω–≥ 3 —Ä–µ—Ü–µ–ø—Ç–æ–≤..."
php8.1 artisan recipes:parse --count=3
echo "‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω"
echo ""

# 6. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
echo "üìä –®–∞–≥ 6/6: –¢–µ–∫—É—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞..."
php8.1 artisan db:check
echo ""

# –§–∏–Ω–∞–ª
echo "=========================================="
echo "‚úÖ –ù–ê–°–¢–†–û–ô–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê!"
echo "=========================================="
echo ""
echo "üî• –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:"
echo ""
echo "1Ô∏è‚É£  –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CRONTAB:"
echo "   crontab -e"
echo ""
echo "2Ô∏è‚É£  –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É:"
echo "   */30 * * * * cd /home/g/gamechann2/im-edok_ru && php8.1 artisan recipes:parse --count=42 >> storage/logs/parser.log 2>&1"
echo ""
echo "3Ô∏è‚É£  –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –≤—ã–π–¥–∏—Ç–µ (Ctrl+X, –∑–∞—Ç–µ–º Y, Enter)"
echo ""
echo "4Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ cron –¥–æ–±–∞–≤–ª–µ–Ω:"
echo "   crontab -l"
echo ""
echo "5Ô∏è‚É£  –ß–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:"
echo "   php8.1 artisan parser:status"
echo ""
echo "=========================================="
echo "üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 2016 —Ä–µ—Ü–µ–ø—Ç–æ–≤/–¥–µ–Ω—å"
echo "   (48 –∑–∞–ø—É—Å–∫–æ–≤ √ó 42 —Ä–µ—Ü–µ–ø—Ç–∞)"
echo "=========================================="
